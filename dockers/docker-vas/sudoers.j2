#
# This file MUST be edited with the 'visudo' command as root.
#
# Please consider adding local content in /etc/sudoers.d/ instead of
# directly modifying this file.
#
# See the man page for details on how to write a sudoers file.
#
Defaults        env_reset
#Defaults        mail_badpass
Defaults        secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
Defaults        env_keep += "VTYSH_PAGER"

# Host alias specification

# User alias specification

# Cmnd alias specification
# Note: bcmcmd is dangerous for users in read only netgroups because it may operate ASIC
Cmnd_Alias      READ_ONLY_CMDS = /usr/bin/decode-syseeprom, \
                                 /usr/bin/docker images *, \
                                 /usr/bin/docker exec -it snmp cat /etc/snmp/snmpd.conf, \
                                 /usr/bin/docker exec -it bgp cat /etc/quagga/bgpd.conf, \
                                 /usr/bin/docker ps, \
                                 /usr/bin/generate_dump, \
                                 /usr/bin/lldpctl, \
                                 /usr/bin/lldpshow, \
                                 /usr/bin/sensors, \
                                 /usr/bin/sfputil show *, \
                                 /usr/bin/vtysh -c show *, \
                                 /bin/cat /var/log/syslog, \
                                 /usr/bin/tail -f /var/log/syslog

# User privilege specification
root    ALL=(ALL:ALL) ALL

# Allow members of group sudo to execute any command
%sudo   ALL=(ALL:ALL) NOPASSWD: ALL

#read write netgroups
{% for netgroup in rw_netgroups %}
%{{ netgroup }} ALL=(ALL:ALL) NOPASSWD: ALL
{% endfor %}
{% if DEVICE_METADATA and DEVICE_METADATA['localhost'].has_key('deployment_id') %}
{% set deployment_id = DEVICE_METADATA['localhost']['deployment_id'] %}
{% endif %}
{% if deployment_id | int == 1 or deployment_id | int == 3 %}
{% for netgroup in rw_netgroups_ap %}
%{{ netgroup }} ALL=(ALL:ALL) NOPASSWD: ALL
{% endfor %}
{% endif %}
{% if deployment_id | int == 2 or deployment_id | int == 4 %}
{% for netgroup in rw_netgroups_az %}
%{{ netgroup }} ALL=(ALL:ALL) NOPASSWD: ALL
{% endfor %}
{% endif %}

#read only netgroups
{% for netgroup in ro_netgroups %}
%{{ netgroup }} ALL= NOPASSWD: READ_ONLY_CMDS
{% endfor %}

# See sudoers(5) for more information on "#include" directives:

#includedir /etc/sudoers.d
